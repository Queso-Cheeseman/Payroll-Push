<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>2025 Payroll Push Progress Tracker</title>
  <link rel="icon" href="data:,">
  <style>
    :root {
      --night: #020617;
      --card-text: #0f172a;
      --accent-blue: #38bdf8;
      --accent-teal: #2dd4bf;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      color: #ffffff;
      background-color: var(--night);  /* solid dark base */
      overflow: hidden;
    }

    /* Starry sky */
    #star-layer {
      position: fixed;
      inset: 0;
      pointer-events: none;
      z-index: 0;
      overflow: hidden;
    }

    .star {
      position: absolute;
      width: 2px;
      height: 2px;
      border-radius: 50%;
      background: rgba(255,255,255,0.8);
      opacity: 0.3;
      box-shadow: 0 0 6px rgba(255,255,255,0.6);
      animation: starTwinkle 4s ease-in-out infinite alternate;
    }

    @keyframes starTwinkle {
      0%   { opacity: 0.2; transform: scale(0.9); }
      50%  { opacity: 0.9; transform: scale(1.4); }
      100% { opacity: 0.3; transform: scale(1); }
    }

    /* Aurora / Northern lights ‚Äì gentle, no harsh seams */
    #aurora-layer {
      position: fixed;
      inset: 0;
      pointer-events: none;
      z-index: 0;
      overflow: hidden;
      mix-blend-mode: screen;
    }

    #aurora-layer::before {
      content: "";
      position: absolute;
      inset: -40% -25%;
      background:
        radial-gradient(circle at 10% 0, rgba(129, 230, 217, 0.5), transparent 60%),
        radial-gradient(circle at 70% 10%, rgba(56, 189, 248, 0.5), transparent 60%);
      filter: blur(22px);
      opacity: 0.6;
      animation: auroraWave 22s ease-in-out infinite alternate;
    }

    #aurora-layer::after {
      content: "";
      position: absolute;
      inset: -45% -30%;
      background:
        radial-gradient(circle at 20% 10%, rgba(96, 165, 250, 0.55), transparent 60%),
        radial-gradient(circle at 80% 0, rgba(45, 212, 191, 0.4), transparent 60%);
      filter: blur(28px);
      opacity: 0.4;
      animation: auroraWave2 28s ease-in-out infinite alternate;
    }

    @keyframes auroraWave {
      0%   { transform: translateX(-12%) translateY(4%) skewY(-4deg) scaleY(1); }
      50%  { transform: translateX(10%) translateY(-3%) skewY(4deg)  scaleY(1.06); }
      100% { transform: translateX(-8%)  translateY(2%) skewY(-3deg) scaleY(1.02); }
    }

    @keyframes auroraWave2 {
      0%   { transform: translateX(8%) translateY(-4%) skewY(3deg)  scaleY(1.02); }
      50%  { transform: translateX(-6%) translateY(3%)  skewY(-3deg) scaleY(1.07); }
      100% { transform: translateX(6%) translateY(-2%) skewY(2deg)  scaleY(1.03); }
    }

    /* Snow */
    #snow-layer {
      position: fixed;
      inset: 0;
      pointer-events: none;
      overflow: hidden;
      z-index: 1;
    }

    .snowflake {
      position: absolute;
      top: -10px;
      color: #ffffff;
      opacity: 0.75;
      pointer-events: none;
      animation-name: snowfall;
      animation-timing-function: linear;
      animation-iteration-count: 1;
    }

    @keyframes snowfall {
      0% {
        transform: translateY(-10px) translateX(0);
        opacity: 0;
      }
      10% {
        opacity: 0.9;
      }
      100% {
        transform: translateY(110vh) translateX(40px);
        opacity: 0;
      }
    }

    /* MAIN TRACKER CARD ‚Äì frosted + 3D */
.tracker-card {
  position: relative;
  padding: 32px 40px;
  border-radius: 24px;

  /* Softer, more translucent glass */
  background: linear-gradient(
    145deg,
    rgba(255, 255, 255, 0.78),
    rgba(248, 250, 252, 0.68)
  );
  backdrop-filter: blur(22px);
  -webkit-backdrop-filter: blur(22px);

  border: 1px solid rgba(148, 163, 184, 0.55);

  box-shadow:
    0 26px 60px rgba(0, 0, 0, 0.7),
    0 1px 0 rgba(255, 255, 255, 0.85);

  width: min(900px, 90vw);
  z-index: 2;
}
.tracker-card::before {
  background: linear-gradient(to bottom, rgba(255,255,255,0.2), transparent 65%);
  opacity: 0.6;
}

    /* subtle top highlight to enhance 3D, but STATIC (no white animation) */
    .tracker-card::after {
      content: "";
      position: absolute;
      inset: 0;
      border-radius: inherit;
      background: linear-gradient(to bottom, rgba(255,255,255,0.24), transparent 65%);
      pointer-events: none;
      opacity: 0.85;
    }

    @keyframes cardFloat {
      0%   { transform: translateY(0px); }
      50%  { transform: translateY(-4px); }
      100% { transform: translateY(1px); }
    }

    /* make text inside card dark & readable */
    .tracker-card,
    .tracker-card * {
      color: var(--card-text);
    }

    /* HEADER */
    .tracker-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 16px;
      margin-bottom: 24px;
      position: relative;
      z-index: 1;
    }

    .title-block {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .title-block h1 {
      margin: 0;
      font-size: 32px;
      letter-spacing: 0.06em;
      text-transform: uppercase;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .title-block h1 span.emoji {
      font-size: 30px;
      filter: drop-shadow(0 0 4px rgba(148, 163, 184, 0.6));
    }

    .subtitle {
      font-size: 13px;
      opacity: 0.8;
    }

    /* clean winter badge ‚Äì no shimmer animation now */
    .badge {
      padding: 6px 14px;
      border-radius: 999px;
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      background: linear-gradient(120deg, #e0f2fe, #bae6fd);
      color: #0f172a;
      font-weight: 700;
      box-shadow:
        0 6px 14px rgba(15, 23, 42, 0.25),
        0 0 0 1px rgba(148, 163, 184, 0.5);
      position: relative;
      z-index: 1;
    }

    /* METRICS */
    .main-metrics {
      display: flex;
      justify-content: space-between;
      align-items: flex-end;
      gap: 24px;
      margin-bottom: 24px;
      flex-wrap: wrap;
      position: relative;
      z-index: 1;
    }

    .metric-left {
      display: flex;
      flex-direction: column;
    }

    .current-total {
      font-size: 52px;
      font-weight: 800;
      line-height: 1;
      color: var(--card-text);
      text-shadow: 0 1px 0 rgba(255,255,255,0.8);
    }

    .current-label {
      font-size: 14px;
      opacity: 0.7;
      margin-top: 6px;
    }

    .percent-block {
      text-align: right;
    }

    .percent-value {
      font-size: 28px;
      font-weight: 700;
      color: var(--card-text);
    }

    /* LFG chip ‚Äì matches card background / glassy style */
    .percent-chip {
      margin-top: 4px;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 12px;
      border-radius: 999px;
      font-size: 12px;

      background: rgba(255,255,255,0.9);
      border: 1px solid rgba(148,163,184,0.7);
      box-shadow:
        0 4px 10px rgba(15, 23, 42, 0.18),
        0 0 0 1px rgba(255,255,255,0.7);

      color: var(--card-text);
    }

    .percent-chip span.icon {
      font-size: 16px;
      /* stronger, playful rock */
      animation: iconWiggle 1.4s ease-in-out infinite;
      display: inline-block;
    }

    @keyframes iconWiggle {
      0%, 100% { transform: translateY(0) rotate(0deg); }
      20%      { transform: translateY(-1px) rotate(-22deg); }
      40%      { transform: translateY(0)   rotate(16deg);  }
      60%      { transform: translateY(-0.5px) rotate(-10deg); }
      80%      { transform: translateY(0)   rotate(6deg);   }
    }

    /* PROGRESS BAR */
    .line-section {
      margin-top: 4px;
      position: relative;
      z-index: 1;
    }

    .line-track {
      position: relative;
      width: 100%;
      height: 14px;
      border-radius: 999px;
      background: linear-gradient(90deg, rgba(148,163,184,0.25), rgba(209,213,219,0.3));
      overflow: hidden;
      box-shadow:
        inset 0 0 3px rgba(148, 163, 184, 0.9),
        0 2px 4px rgba(15, 23, 42, 0.15);
    }

    .line-fill {
      position: absolute;
      inset: 0;
      width: 0%;
      background: linear-gradient(90deg, var(--accent-teal), var(--accent-blue));
      border-radius: inherit;
      box-shadow:
        0 0 12px rgba(56, 189, 248, 0.8),
        0 0 24px rgba(45, 212, 191, 0.7);
      transition: width 0.8s cubic-bezier(0.16, 1, 0.3, 1);
    }

    .line-dot {
      position: absolute;
      top: 50%;
      left: 0%;
      transform: translate(-50%, -50%);
      width: 24px;
      height: 24px;
      border-radius: 50%;
      background: radial-gradient(circle at 30% 30%, #f9fafb, #e0f2fe);
      box-shadow:
        0 0 10px rgba(56, 189, 248, 0.8),
        0 0 18px rgba(45, 212, 191, 0.9);
      border: 1px solid rgba(15,23,42,0.15);
      transition: left 0.8s cubic-bezier(0.16, 1, 0.3, 1);
    }

    .line-dot::after {
      content: "";
      position: absolute;
      inset: 4px;
      border-radius: inherit;
      border: 1px solid rgba(148,163,184,0.8);
    }

    .line-labels {
      display: flex;
      justify-content: space-between;
      margin-top: 10px;
      font-size: 13px;
      color: var(--card-text);
      opacity: 0.8;
      position: relative;
      z-index: 1;
    }

    .hidden-inputs {
      display: none;
    }

    /* SANTA FLY-BY */
    #santa-flyby {
      position: fixed;
      top: 12vh;
      left: -700px;
      pointer-events: none;
      z-index: 4;
      opacity: 0;
    }

    #santa-flyby .formation {
      position: relative;
    }

    #santa-flyby .sleigh-wrapper {
      display: inline-flex;
      align-items: center;
      gap: 24px;
    }

    #santa-flyby.direction-ltr .sleigh-wrapper {
      flex-direction: row;
    }

    #santa-flyby.direction-rtl .sleigh-wrapper {
      flex-direction: row-reverse;
    }

    .reindeer-team {
      display: flex;
      gap: 10px;
    }

    .reindeer-team svg.reindeer {
      height: 56px;
      animation: rGallop 0.45s ease-in-out infinite alternate;
      fill: #020816;
    }

    .reindeer-team .reindeer:nth-child(1),
    .reindeer-team .reindeer:nth-child(2) {
      transform: translateY(-12px);
    }
    .reindeer-team .reindeer:nth-child(3),
    .reindeer-team .reindeer:nth-child(4) {
      transform: translateY(-6px);
    }
    .reindeer-team .reindeer:nth-child(5),
    .reindeer-team .reindeer:nth-child(6) {
      transform: translateY(-1px);
    }
    .reindeer-team .reindeer:nth-child(7),
    .reindeer-team .reindeer:nth-child(8) {
      transform: translateY(5px);
    }
    .reindeer-team .reindeer:nth-child(9) {
      transform: translateY(2px);
    }

    .santa-sleigh {
      height: 90px;
      filter: drop-shadow(0 0 12px rgba(255,255,255,0.45));
    }

    @keyframes rGallop {
      from { transform: translateY(0); }
      to   { transform: translateY(-6px); }
    }

    #santa-flyby.direction-ltr.fly {
      opacity: 1;
      animation: flyby-ltr 13s linear forwards;
    }

    #santa-flyby.direction-rtl.fly {
      opacity: 1;
      animation: flyby-rtl 13s linear forwards;
    }

    @keyframes flyby-ltr {
      0%   { transform: translateX(-130vw) translateY(0vh); opacity:0; }
      10%  { opacity:1; }
      50%  { transform: translateX(0vw) translateY(-8vh); }
      90%  { opacity:1; }
      100% { transform: translateX(120vw) translateY(0vh); opacity:0; }
    }

    @keyframes flyby-rtl {
      0%   { transform: translateX(120vw) translateY(0vh); opacity:0; }
      10%  { opacity:1; }
      50%  { transform: translateX(0vw) translateY(-8vh); }
      90%  { opacity:1; }
      100% { transform: translateX(-130vw) translateY(0vh); opacity:0; }
    }

    .sparkle-container {
      position: absolute;
      inset: 0;
      overflow: visible;
    }

    .sparkle {
      position: absolute;
      width: 5px;
      height: 5px;
      border-radius: 50%;
      background: white;
      box-shadow: 0 0 8px rgba(255,255,255,0.9);
      opacity: 0;
      animation: sparkleFade 1.1s ease-out forwards;
    }

    @keyframes sparkleFade {
      0%   { transform: scale(0.4); opacity:0; }
      20%  { opacity:1; }
      100% { transform: translate(-40px, -20px) scale(1); opacity:0; }
    }

    @media (max-width: 540px) {
      .tracker-card {
        padding: 24px 18px;
      }
      .current-total {
        font-size: 42px;
      }
      .tracker-header {
        flex-direction: column;
        align-items: flex-start;
      }
      .percent-block {
        text-align: left;
      }
      #santa-flyby {
        top: 8vh;
      }
    }
  </style>
</head>
<body>

  <!-- Background layers -->
  <div id="star-layer"></div>
  <div id="aurora-layer"></div>
  <div id="snow-layer"></div>

  <!-- Santa fly-by -->
  <div id="santa-flyby" class="direction-ltr">
    <div class="formation">
      <div class="sleigh-wrapper">
        <div class="reindeer-team">
          <!-- Rudolph + 8 more -->
          <svg class="reindeer rudolph" viewBox="0 0 120 60" aria-hidden="true">
            <path d="M15 40 L35 35 L55 40 L75 38 L95 25 L80 10 L55 18 L35 12 L15 16 Z" fill="black"/>
            <circle cx="95" cy="25" r="4" fill="black"/>
            <path d="M90 10 L85 2 M92 10 L97 2" stroke="black" stroke-width="4" stroke-linecap="round"/>
          </svg>
          <!-- 8 identical reindeer -->
          <svg class="reindeer" viewBox="0 0 120 60" aria-hidden="true">
            <path d="M15 40 L35 35 L55 40 L75 38 L95 25 L80 10 L55 18 L35 12 L15 16 Z" fill="black"/>
            <circle cx="95" cy="25" r="4" fill="black"/>
            <path d="M90 10 L85 2 M92 10 L97 2" stroke="black" stroke-width="4" stroke-linecap="round"/>
          </svg>
          <svg class="reindeer" viewBox="0 0 120 60" aria-hidden="true">
            <path d="M15 40 L35 35 L55 40 L75 38 L95 25 L80 10 L55 18 L35 12 L15 16 Z" fill="black"/>
            <circle cx="95" cy="25" r="4" fill="black"/>
            <path d="M90 10 L85 2 M92 10 L97 2" stroke="black" stroke-width="4" stroke-linecap="round"/>
          </svg>
          <svg class="reindeer" viewBox="0 0 120 60" aria-hidden="true">
            <path d="M15 40 L35 35 L55 40 L75 38 L95 25 L80 10 L55 18 L35 12 L15 16 Z" fill="black"/>
            <circle cx="95" cy="25" r="4" fill="black"/>
            <path d="M90 10 L85 2 M92 10 L97 2" stroke="black" stroke-width="4" stroke-linecap="round"/>
          </svg>
          <svg class="reindeer" viewBox="0 0 120 60" aria-hidden="true">
            <path d="M15 40 L35 35 L55 40 L75 38 L95 25 L80 10 L55 18 L35 12 L15 16 Z" fill="black"/>
            <circle cx="95" cy="25" r="4" fill="black"/>
            <path d="M90 10 L85 2 M92 10 L97 2" stroke="black" stroke-width="4" stroke-linecap="round"/>
          </svg>
          <svg class="reindeer" viewBox="0 0 120 60" aria-hidden="true">
            <path d="M15 40 L35 35 L55 40 L75 38 L95 25 L80 10 L55 18 L35 12 L15 16 Z" fill="black"/>
            <circle cx="95" cy="25" r="4" fill="black"/>
            <path d="M90 10 L85 2 M92 10 L97 2" stroke="black" stroke-width="4" stroke-linecap="round"/>
          </svg>
          <svg class="reindeer" viewBox="0 0 120 60" aria-hidden="true">
            <path d="M15 40 L35 35 L55 40 L75 38 L95 25 L80 10 L55 18 L35 12 L15 16 Z" fill="black"/>
            <circle cx="95" cy="25" r="4" fill="black"/>
            <path d="M90 10 L85 2 M92 10 L97 2" stroke="black" stroke-width="4" stroke-linecap="round"/>
          </svg>
          <svg class="reindeer" viewBox="0 0 120 60" aria-hidden="true">
            <path d="M15 40 L35 35 L55 40 L75 38 L95 25 L80 10 L55 18 L35 12 L15 16 Z" fill="black"/>
            <circle cx="95" cy="25" r="4" fill="black"/>
            <path d="M90 10 L85 2 M92 10 L97 2" stroke="black" stroke-width="4" stroke-linecap="round"/>
          </svg>
          <svg class="reindeer" viewBox="0 0 120 60" aria-hidden="true">
            <path d="M15 40 L35 35 L55 40 L75 38 L95 25 L80 10 L55 18 L35 12 L15 16 Z" fill="black"/>
            <circle cx="95" cy="25" r="4" fill="black"/>
            <path d="M90 10 L85 2 M92 10 L97 2" stroke="black" stroke-width="4" stroke-linecap="round"/>
          </svg>
        </div>

        <svg class="santa-sleigh" viewBox="0 0 260 100" aria-hidden="true">
          <path d="M10 70 
                   Q30 90 80 85 
                   Q90 80 90 65 
                   L160 65 
                   Q180 65 190 55 
                   Q200 45 190 30 
                   Q170 10 130 20 
                   Q100 25 95 40 
                   L70 40 
                   Q40 45 10 70 Z"
                fill="#050816"/>
          <path d="M105 30 
                   Q115 10 135 18 
                   Q150 25 148 40 
                   Q150 60 130 60 
                   Q115 58 110 45 
                   Q108 40 105 30 Z"
                fill="#050816"/>
          <path d="M150 25 
                   Q145 10 165 5 
                   Q190 0 200 20 
                   Q210 40 190 55 
                   Q170 65 155 55 
                   Q140 45 150 25 Z"
                fill="#050816"/>
          <path d="M145 45 Q180 35 230 30" stroke="#050816" stroke-width="5" stroke-linecap="round"/>
        </svg>
      </div>
      <div class="sparkle-container"></div>
    </div>
  </div>

  <!-- Main tracker card -->
  <div class="tracker-card">
    <div class="tracker-header">
      <div class="title-block">
        <h1>
          <span class="emoji">üéÑ</span>
          2025 Payroll Push
        </h1>
        <div class="subtitle">
          Cozy progress toward your year-end customer goal.
        </div>
      </div>
      <div class="badge">
        ‚ùÑ Snow Day Progress
      </div>
    </div>

    <div class="main-metrics">
      <div class="metric-left">
        <div class="current-total" id="totalDisplay">627</div>
        <div class="current-label">Total customers so far</div>
      </div>
      <div class="percent-block">
        <div class="percent-value" id="percentDisplay">72%</div>
        <div class="percent-chip">
          <span class="icon">‚ùÑÔ∏è</span>
          <span id="chipText">LFG!</span>
        </div>
      </div>
    </div>

    <div class="line-section">
      <div class="line-track">
        <div class="line-fill" id="lineFill"></div>
        <div class="line-dot" id="lineDot"></div>
      </div>
      <div class="line-labels">
        <span>0</span>
        <span>Goal: <span id="goalLabel">870</span></span>
      </div>
    </div>

    <div class="hidden-inputs">
      <input type="number" id="current" value="627">
      <input type="number" id="goal" value="870">
    </div>
  </div>

  <script>
    const currentInput   = document.getElementById("current");
    const goalInput      = document.getElementById("goal");
    const totalDisplay   = document.getElementById("totalDisplay");
    const percentDisplay = document.getElementById("percentDisplay");
    const goalLabel      = document.getElementById("goalLabel");
    const lineFill       = document.getElementById("lineFill");
    const lineDot        = document.getElementById("lineDot");
    const chipText       = document.getElementById("chipText");
    const snowLayer      = document.getElementById("snow-layer");
    const starLayer      = document.getElementById("star-layer");

    let snowIntensity = 0;

    const STORAGE_KEYS = {
      current: "winterGoalCurrent",
      goal: "winterGoalGoal"
    };

    function loadFromStorage() {
      try {
        const savedCurrent = localStorage.getItem(STORAGE_KEYS.current);
        const savedGoal    = localStorage.getItem(STORAGE_KEYS.goal);
        if (savedCurrent !== null) currentInput.value = parseFloat(savedCurrent);
        if (savedGoal !== null)    goalInput.value    = parseFloat(savedGoal);
      } catch (e) {}
    }

    function saveToStorage(current, goal) {
      try {
        localStorage.setItem(STORAGE_KEYS.current, String(current));
        localStorage.setItem(STORAGE_KEYS.goal, String(goal));
      } catch (e) {}
    }

    function updateLine() {
      const current = Math.max(parseFloat(currentInput.value) || 0, 0);
      const goal    = Math.max(parseFloat(goalInput.value) || 1, 1);

      const ratio   = Math.min(current / goal, 1);
      const percent = Math.round(ratio * 100);

      totalDisplay.textContent   = current.toLocaleString();
      percentDisplay.textContent = percent + "%";
      goalLabel.textContent      = goal.toLocaleString();

      const widthPercent = ratio * 100;
      lineFill.style.width = widthPercent + "%";
      lineDot.style.left   = widthPercent + "%";

      if (percent < 25) {
        chipText.textContent = "Just getting started‚Äîfresh snow!";
      } else if (percent < 50) {
        chipText.textContent = "Building the base of the snowman!";
      } else if (percent < 75) {
        chipText.textContent = "LFG!";
      } else if (percent < 100) {
        chipText.textContent = "So close‚Äîhot cocoa is ready!";
      } else {
        chipText.textContent = "Goal reached! Time for a snow day üéâ";
      }

      snowIntensity = ratio;
      saveToStorage(current, goal);
    }

    window.updateGoalProgress = function(currentValue, goalValue) {
      if (typeof currentValue !== "undefined") currentInput.value = currentValue;
      if (typeof goalValue !== "undefined")   goalInput.value    = goalValue;
      updateLine();
    };

    // hidden keyboard controls still work, but not shown in UI
    window.addEventListener("keydown", function (e) {
      const activeTag = document.activeElement.tagName;
      if (activeTag === "INPUT" || activeTag === "TEXTAREA") return;

      let delta = 0;
      switch (e.key) {
        case "ArrowUp":   delta = 1;  break;
        case "ArrowDown": delta = -1; break;
        case "PageUp":    delta = 10; break;
        case "PageDown":  delta = -10; break;
        case "+": case "=": delta = 5;  break;
        case "-": case "_": delta = -5; break;
        default: return;
      }

      e.preventDefault();
      const current = Math.max(parseFloat(currentInput.value) || 0, 0);
      const next = Math.max(current + delta, 0);
      currentInput.value = next;
      updateLine();
    });

    function spawnSnowflake() {
      const flake = document.createElement("div");
      flake.className = "snowflake";

      const chars = ["‚ùÑÔ∏è", "‚ùÖ", "‚ùÜ"];
      flake.textContent = chars[Math.floor(Math.random() * chars.length)];

      const intensity = Math.max(0.1, snowIntensity);
      const minDuration = 3;
      const maxDuration = 10;
      const duration = maxDuration - intensity * (maxDuration - minDuration);

      const minSize = 10;
      const maxSize = 26;
      const size = minSize + intensity * (maxSize - minSize);

      const left = Math.random() * 100;
      const delayJitter = Math.random() * 0.5;

      flake.style.left = left + "vw";
      flake.style.fontSize = size + "px";
      flake.style.animationDuration = duration + "s";
      flake.style.animationDelay = delayJitter + "s";

      snowLayer.appendChild(flake);
      setTimeout(() => flake.remove(), (duration + delayJitter + 1) * 1000);

      const maxInterval = 900;
      const minInterval = 120;
      const nextDelay = maxInterval - intensity * (maxInterval - minInterval);
      setTimeout(spawnSnowflake, nextDelay);
    }

    function initStars(count) {
      if (!starLayer) return;
      for (let i = 0; i < count; i++) {
        const star = document.createElement("div");
        star.className = "star";
        star.style.left = Math.random() * 100 + "vw";
        star.style.top  = Math.random() * 100 + "vh";
        const scale = 0.6 + Math.random() * 1.6;
        star.style.transform = "scale(" + scale + ")";
        star.style.animationDelay = (Math.random() * 6) + "s";
        starLayer.appendChild(star);
      }
    }

    (function () {
      const root = document.getElementById('santa-flyby');
      if (!root) return;
      const sparkleContainer = root.querySelector('.sparkle-container');

      function random(min, max) {
        return Math.random() * (max - min) + min;
      }

      let sparkleInterval = null;
      let direction = 'ltr';

      function createSparkle() {
        const s = document.createElement('div');
        s.className = 'sparkle';
        s.style.left = random(40, 220) + 'px';
        s.style.top  = random(10, 80) + 'px';
        s.addEventListener('animationend', () => s.remove());
        sparkleContainer.appendChild(s);
      }

      function startSparkles() {
        if (sparkleInterval) return;
        sparkleInterval = setInterval(createSparkle, 130);
      }

      function stopSparkles() {
        if (!sparkleInterval) return;
        clearInterval(sparkleInterval);
        sparkleInterval = null;
        sparkleContainer.innerHTML = '';
      }

      function launchSanta() {
        root.classList.remove('direction-ltr', 'direction-rtl');
        root.classList.add(direction === 'ltr' ? 'direction-ltr' : 'direction-rtl');
        root.classList.add('fly');
        startSparkles();

        function handleEnd() {
          root.classList.remove('fly');
          root.removeEventListener('animationend', handleEnd);
          stopSparkles();
          direction = (direction === 'ltr') ? 'rtl' : 'ltr';
          const nextIn = random(20000, 90000);
          setTimeout(launchSanta, nextIn);
        }

        root.addEventListener('animationend', handleEnd);
      }

      const firstIn = random(3000, 9000);
      setTimeout(launchSanta, firstIn);
    })();

    loadFromStorage();
    updateLine();
    spawnSnowflake();
    initStars(80);
  </script>

</body>
</html>
